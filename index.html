<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Santi Tool Kit</title>
  <script src="https://cesium.com/downloads/cesiumjs/releases/1.108/Build/Cesium/Cesium.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/satellite.js/4.0.0/satellite.min.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@easepick/bundle@1.2.1/dist/index.umd.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
  <link href="https://cesium.com/downloads/cesiumjs/releases/1.108/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
  <link rel="stylesheet" href="/stylesheets/style.css">
  <link rel="stylesheet" href="/stylesheets/datepicker.css">
  <link rel="stylesheet" href="/stylesheets/coloris.min.css" />
  <script type="module" src="/javascripts/dynamics.js"></script>
  <script type="module" src="/javascripts/tle.js"></script>
  <script type="text/javascript" src="/javascripts/coloris.min.js"></script>
</head>

<body>
  <!-- Hamburger Menu Toggle Button -->
  <button class="menu-toggle" id="menuToggle" aria-label="Toggle Navigation Menu">
    <span></span>
    <span></span>
    <span></span>
  </button>

  <!-- Menu Overlay -->
  <div class="menu-overlay" id="menuOverlay"></div>

  <!-- Main Slide-in Menu -->
  <nav class="slide-menu" id="slideMenu" role="navigation" aria-label="Main Navigation">
    <!-- Menu Header -->
    <div class="menu-header">
      <h2 class="menu-title"></h2>
    </div>

    <!-- TLE Input Section -->
    <section class="menu-section">
      <h3 class="menu-section-title">Orbital Parameters</h3>
      <div class="menu-input-group">
        <label for="tleTextArea">TLE Data</label>
        <textarea id="tleTextArea" class="tleInput"
          placeholder="SAOCOM-1B&#13;&#10;1 46265U 20059A   23219.44152368  .00000647  00000-0  87861-4 0  9990&#13;&#10;2 46265  97.8904  44.2657 0001383  88.6861 271.4511 14.82150595158748"
          rows="3"></textarea>
      </div>
    </section>

    <!-- Orbital Elements Section -->
    <section class="menu-section">
      <div class="menu-input-row">
        <div class="menu-input-group">
          <label for="semiMajorAxis">Semi-Major Axis (km)</label>
          <input type="number" id="semiMajorAxis" placeholder="a [Km]" min="250" max="120000">
        </div>
        <div class="menu-input-group">
          <label for="eccentricity">Eccentricity</label>
          <input type="number" id="eccentricity" placeholder="ecc." min="0" max="0.9999" step="0.0001">
        </div>
        <div class="menu-input-group">
          <label for="inclination">Inclination (°)</label>
          <input type="number" id="inclination" placeholder="inc. [°]" min="0" max="180">
        </div>
      </div>

      <div class="menu-input-row">
        <div class="menu-input-group">
          <label for="rightAscension">RAAN (°)</label>
          <input type="number" id="rightAscension" placeholder="RAAN [°]" min="-360" max="360">
        </div>
        <div class="menu-input-group">
          <label for="argumentOfPerigee">Arg. of Perigee (°)</label>
          <input type="number" id="argumentOfPerigee" placeholder="arg. p [°]" min="-360" max="360">
        </div>
        <div class="menu-input-group">
          <label for="anomaly">Mean Anomaly (°)</label>
          <input type="number" id="anomaly" placeholder="anom [°]" min="-360" max="360">
        </div>
      </div>
    </section>

    <!-- Time & Propagation Section -->
    <section class="menu-section">

      <!-- Two-column datetime layout with separate label and input rows -->
      <div class="menu-datetime-labels">
        <label for="datepicker" class="datetime-label-main">Date & Time</label>
        <label for="timestepInSeconds" class="datetime-label-step">Step (s)</label>
      </div>
      <div class="menu-datetime-inputs">
        <input type="text" id="datepicker" class="datetime-input-main">
        <input type="number" id="timestepInSeconds" class="datetime-input-step" min="1" max="600" step="1" value="30">
      </div>

      <div class="menu-button-row">
        <button id="propagateFromTLE" class="menu-button">Prop. TLE</button>
        <button id="propagateFromElements" class="menu-button">Prop. Elements</button>
        <button id="clearButton" class="menu-button">Clear</button>
      </div>
    </section>

    <!-- Ground Station Section -->
    <section class="menu-section">
      <h3 class="menu-section-title">Ground Station</h3>
      <div class="menu-input-row">
        <div class="menu-input-group">
          <label for="observerCoordinates">Observer Coordinates</label>
          <input type="text" id="observerCoordinates" placeholder="lat[°],lon[°],height[m]">
        </div>
        <div class="menu-input-group">
          <label for="visibilityThreshold">Visibility Threshold</label>
          <input type="number" id="visibilityThreshold" placeholder="Th [°]" min="0" max="89">
        </div>
      </div>

      <div class="menu-button-row">
        <button id="addStation" class="menu-button">Add Station</button>
        <button id="computeAccess" class="menu-button">Compute Access</button>
      </div>
    </section>

    <!-- Visualization Options Section -->
    <section class="menu-section">
      <h3 class="menu-section-title">Display Options</h3>

      <div class="checkbox-grid">
        <label class="menu-checkbox">
          <input type="checkbox" id="showSunlight" checked>
          <span class="checkmark"></span>
          <span class="checkbox-label">Show sunlight/shadow</span>
        </label>

        <label class="menu-checkbox">
          <input type="checkbox" id="showEQPlane">
          <span class="checkmark"></span>
          <span class="checkbox-label">Display EQ plane</span>
        </label>

        <label class="menu-checkbox">
          <input type="checkbox" id="showLabels" checked>
          <span class="checkmark"></span>
          <span class="checkbox-label">Show labels</span>
        </label>

        <label class="menu-checkbox">
          <input type="checkbox" id="showIcons" checked>
          <span class="checkmark"></span>
          <span class="checkbox-label">Show Icons</span>
        </label>
      </div>

      <div class="menu-input-group">
        <label for="color-picker">Satellite Color</label>
        <input id="color-picker" type="text" value="#d062df91" data-coloris>
      </div>

      <!--
      <div class="menu-button-row">
        <button class="menu-button">Apply Settings</button>
        <button class="menu-button">Reset</button>
      </div>
      -->
    </section>

    <!-- External Tools Section -->
    <section class="menu-section">
      <h3 class="menu-section-title">Experimental Features</h3>
      <div class="menu-input-row">
        <div class="menu-input-group">
          <label for="rightAscension">T</label>
          <input type="number" id="nOfSats" placeholder="No. of Sats" min="1" max="2000">
        </div>
        <div class="menu-input-group">
          <label for="argumentOfPerigee">P</label>
          <input type="number" id="nOfPlanes" placeholder="No. of Planes" min="1" max="50">
        </div>
        <div class="menu-input-group">
          <label for="anomaly">F</label>
          <input type="number" id="phaseOffset" placeholder="Phase [°]" min="-360" max="360">
        </div>
      </div>
      <div class="menu-button-row">
        <button id="populateWalkerDelta" class="menu-button">Populate Walker-Delta</button>
        <button id="takeSnapshot" class="menu-button">Take Snapshot!</button>
      </div>
    </section>
  </nav>

  <div class="row">
    <div class="column right">
      <div id="toolbar"></div>
      <div id="cesiumContainer">
        <!--<iframe src="/cesium"></iframe>-->
      </div>
    </div>
  </div>
  <div class="row">
    <figure class="tabBlock">
      <ul class="tabBlock-tabs">
        <li class="tabBlock-tab is-active">ECI</li>
        <li class="tabBlock-tab">ECEF</li>
        <li class="tabBlock-tab">JSON-ECI</li>
        <li class="tabBlock-tab">Access intervals</li>
      </ul>
      <div class="tabBlock-content">
        <div class="tabBlock-pane">
          <textarea id="eciCoordinates" placeholder="X,Y,Z ECI"></textarea>
        </div>
        <div class="tabBlock-pane" id="ECEFcoord">
          <textarea id="ecefCoordinates" placeholder="X,Y,Z ECI"></textarea>
        </div>
        <div class="tabBlock-pane" id="ECEFcoord">
          <textarea id="jsonECI" placeholder="X,Y,Z ECI"></textarea>
        </div>
        <div class="tabBlock-pane" id="accessIntervals">
          <textarea id="accessTextArea">Ask for instructions to compute access intervals</textarea>
        </div>
      </div>
    </figure>
  </div>
  </div>

  <script>
    /* ===================================
       MODERN SLIDE-IN MENU FUNCTIONALITY
       =================================== */

    // Menu state management
    class SlideMenu {
      constructor() {
        this.menuToggle = document.getElementById('menuToggle');
        this.menuOverlay = document.getElementById('menuOverlay');
        this.slideMenu = document.getElementById('slideMenu');
        this.isMenuOpen = false;

        this.init();
      }

      init() {
        // Bind event listeners
        this.menuToggle.addEventListener('click', () => this.toggleMenu());
        this.menuOverlay.addEventListener('click', () => this.closeMenu());

        // Handle escape key
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && this.isMenuOpen) {
            this.closeMenu();
          }
        });

        // Prevent body scroll when menu is open
        this.slideMenu.addEventListener('scroll', (e) => {
          e.stopPropagation();
        });
      }

      toggleMenu() {
        if (this.isMenuOpen) {
          this.closeMenu();
        } else {
          this.openMenu();
        }
      }

      openMenu() {
        this.isMenuOpen = true;
        this.menuToggle.classList.add('active');
        this.menuOverlay.classList.add('active');
        this.slideMenu.classList.add('active');

        // Prevent body scroll
        document.body.style.overflow = 'hidden';

        // Focus management for accessibility
        this.slideMenu.focus();
      }

      closeMenu() {
        this.isMenuOpen = false;
        this.menuToggle.classList.remove('active');
        this.menuOverlay.classList.remove('active');
        this.slideMenu.classList.remove('active');

        // Restore body scroll
        document.body.style.overflow = '';
      }
    }

    // Initialize menu when DOM is ready
    document.addEventListener('DOMContentLoaded', () => {
      const menu = new SlideMenu();
    });

    // Tab functionality (existing)
    var TabBlock = {
      s: {
        animLen: 200
      },

      init: function () {
        TabBlock.bindUIActions();
        TabBlock.hideInactive();
      },

      bindUIActions: function () {
        $('.tabBlock-tabs').on('click', '.tabBlock-tab', function () {
          TabBlock.switchTab($(this));
        });
      },

      hideInactive: function () {
        var $tabBlocks = $('.tabBlock');

        $tabBlocks.each(function (i) {
          var
            $tabBlock = $($tabBlocks[i]),
            $panes = $tabBlock.find('.tabBlock-pane'),
            $activeTab = $tabBlock.find('.tabBlock-tab.is-active');

          $panes.hide();
          $($panes[$activeTab.index()]).show();
        });
      },

      switchTab: function ($tab) {
        var $context = $tab.closest('.tabBlock');
        if (!$tab.hasClass('is-active')) {
          $tab.siblings().removeClass('is-active');
          $tab.addClass('is-active');
          TabBlock.showPane($tab.index(), $context);
        }
      },

      showPane: function (i, $context) {
        var $panes = $context.find('.tabBlock-pane');
        $panes.slideUp(TabBlock.s.animLen);
        $($panes[i]).slideDown(TabBlock.s.animLen);
      }
    };

    // Initialize tabs when jQuery is ready
    $(function () {
      TabBlock.init();
    });


  </script>
  <script type="text/javascript">
    Coloris({
      theme: 'polaroid',
      themeMode: 'dark',
    });
  </script>
</body>

</html>